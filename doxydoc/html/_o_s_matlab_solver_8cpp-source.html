<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>/Users/kmartin/Documents/files/code/cpp/OScpp/COIN-OS/OS/src/OSModelInterfaces/OSMatlabSolver.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>/Users/kmartin/Documents/files/code/cpp/OScpp/COIN-OS/OS/src/OSModelInterfaces/OSMatlabSolver.cpp</h1><a href="_o_s_matlab_solver_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include "mex.h"</span>
<a name="l00005"></a>00005 
<a name="l00006"></a>00006 
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="comment">// OS includes</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include "<a class="code" href="_o_s_data_structures_8h.html">OSDataStructures.h</a>"</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include "<a class="code" href="_o_s_parameters_8h.html" title="Robert Fourer, Jun Ma, Kipp Martin,">OSParameters.h</a>"</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include "<a class="code" href="_o_s_matlab_8h.html" title="Robert Fourer, Jun Ma, Kipp Martin,">OSMatlab.h</a>"</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="comment">/* If you are using a compiler that equates NaN to be zero, you must</span>
<a name="l00016"></a>00016 <span class="comment"> * compile this example using the flag  -DNAN_EQUALS_ZERO. For example:</span>
<a name="l00017"></a>00017 <span class="comment"> *</span>
<a name="l00018"></a>00018 <span class="comment"> *     mex -DNAN_EQUALS_ZERO fulltosparse.c</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * This will correctly define the IsNonZero macro for your C compiler.</span>
<a name="l00021"></a>00021 <span class="comment"> */</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <span class="preprocessor">#if defined(NAN_EQUALS_ZERO)</span>
<a name="l00024"></a>00024 <span class="preprocessor"></span><span class="preprocessor">#define IsNonZero(d) ((d)!=0.0 || mxIsNaN(d))</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00026"></a><a class="code" href="_o_s_matlab_solver_8cpp.html#c3792b5c39559a3c77903f7b996f5a3f">00026</a> <span class="preprocessor"></span><span class="preprocessor">#define IsNonZero(d) ((d)!=0.0)</span>
<a name="l00027"></a>00027 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span>
<a name="l00029"></a>00029 <span class="keyword">using namespace </span>std;
<a name="l00030"></a>00030 <span class="keyword">using</span> std::cout;
<a name="l00031"></a>00031 <span class="keyword">using</span> std::endl;
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a><a class="code" href="_o_s_matlab_solver_8cpp.html#6a215cbfde54f82a3ce599228fc3fce5">00034</a> <span class="keywordtype">void</span> <a class="code" href="_o_s_matlab_solver_8cpp.html#6a215cbfde54f82a3ce599228fc3fce5">mexFunction</a>( <span class="keywordtype">int</span>  nlhs, mxArray   *plhs[], <span class="keywordtype">int</span>  nrhs, <span class="keyword">const</span> mxArray *prhs[] ) {
<a name="l00045"></a>00045      <span class="keywordtype">int</span> i;
<a name="l00046"></a>00046      <span class="keywordtype">double</span> *pr;
<a name="l00047"></a>00047      <a class="code" href="class_o_s_matlab.html" title="The OSMatlab Class.">OSMatlab</a> *matlabModel = <span class="keyword">new</span> <a class="code" href="class_o_s_matlab.html" title="The OSMatlab Class.">OSMatlab</a>();
<a name="l00048"></a>00048      <span class="keywordtype">string</span> sTest = <span class="stringliteral">""</span>;
<a name="l00049"></a>00049      <span class="keywordtype">char</span> *buf;
<a name="l00050"></a>00050      <a class="code" href="class_sparse_matrix.html" title="a sparse matrix data structure">SparseMatrix</a>* <a class="code" href="_o_s_matlab_solver_8cpp.html#fad77cd2cb47708eaaec3329c5192e2f">getConstraintMatrix</a>( <span class="keyword">const</span> mxArray *prhs);
<a name="l00051"></a>00051      <span class="comment">//</span>
<a name="l00052"></a>00052      <span class="comment">// Check for proper number of input and output arguments</span>
<a name="l00053"></a>00053      mexPrintf(<span class="stringliteral">"BEGIN PROCESSING DATA\n"</span>);
<a name="l00054"></a>00054      <span class="keywordflow">if</span> (nrhs != 15) {
<a name="l00055"></a>00055           mexErrMsgTxt(<span class="stringliteral">"Fifteen input arguments are required."</span>);
<a name="l00056"></a>00056      }
<a name="l00057"></a>00057      
<a name="l00058"></a>00058      
<a name="l00059"></a>00059      <span class="comment">//</span>
<a name="l00060"></a>00060      <span class="comment">// get number of variables and number of constraints</span>
<a name="l00061"></a>00061      matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#e67ede641207a71642fb0c18d455c71b" title="numVar is the number of variables in the problem">numVar</a> =  (int) mxGetScalar( prhs[ 0]) ;
<a name="l00062"></a>00062      matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#fe790121e25d4e2e3d25ca2f2a5e0bb7" title="numCon is the number of constraints in the problem">numCon</a> = (int) mxGetScalar( prhs[ 1]);
<a name="l00063"></a>00063      <span class="comment">//</span>
<a name="l00064"></a>00064      <span class="comment">// get the constraint matrix</span>
<a name="l00065"></a>00065      <span class="comment">// check the data type</span>
<a name="l00066"></a>00066      <span class="keywordflow">if</span> (!(mxIsDouble(prhs[2 ]))){
<a name="l00067"></a>00067           mexErrMsgTxt(<span class="stringliteral">"Constraint matrix A must be of type double."</span>);
<a name="l00068"></a>00068      }
<a name="l00069"></a>00069      <span class="comment">// check the dimension</span>
<a name="l00070"></a>00070      <span class="keywordflow">if</span> ( (mxGetN(prhs[ 2]) != matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#e67ede641207a71642fb0c18d455c71b" title="numVar is the number of variables in the problem">numVar</a>) ||  (mxGetM(prhs[2]) != matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#fe790121e25d4e2e3d25ca2f2a5e0bb7" title="numCon is the number of constraints in the problem">numCon</a>) ){
<a name="l00071"></a>00071           mexErrMsgTxt(<span class="stringliteral">" Constraint matrix A must have number of rows equal to number of constraints and columns equal number of variables \n"</span>);
<a name="l00072"></a>00072      }
<a name="l00073"></a>00073      matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#7fd87a9e4efbf5f4809c8688651c135b" title="sparseMat is a pointer to an OS Sprase Matrix data structure">sparseMat</a> = <a class="code" href="_o_s_matlab_solver_8cpp.html#fad77cd2cb47708eaaec3329c5192e2f">getConstraintMatrix</a>( prhs[2])   ;
<a name="l00074"></a>00074      <span class="comment">// get the rest of the model</span>
<a name="l00075"></a>00075      <span class="comment">//</span>
<a name="l00076"></a>00076      <span class="comment">// both bl and bu should equal the number of rows</span>
<a name="l00077"></a>00077      <span class="comment">//</span>
<a name="l00078"></a>00078      <span class="keywordflow">if</span>(  !mxIsEmpty( prhs[ 3]) ){
<a name="l00079"></a>00079           <span class="keywordflow">if</span> (mxGetN(prhs[3]) != matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#fe790121e25d4e2e3d25ca2f2a5e0bb7" title="numCon is the number of constraints in the problem">numCon</a> ){
<a name="l00080"></a>00080                mexErrMsgTxt(<span class="stringliteral">" Vector BL size must equal the number of rows\n"</span>);
<a name="l00081"></a>00081           }
<a name="l00082"></a>00082           matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#04bc197503de22dd51f33c289d930d60" title="bl is a pointer to the lower bounds on the constraints">bl</a> =  mxGetPr( prhs[ 3]);
<a name="l00083"></a>00083           <span class="comment">// convert Matlab -infinity to OS -infinity</span>
<a name="l00084"></a>00084           <span class="keywordflow">for</span>(i = 0;  i &lt; matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#fe790121e25d4e2e3d25ca2f2a5e0bb7" title="numCon is the number of constraints in the problem">numCon</a>;  i++){
<a name="l00085"></a>00085                <span class="keywordflow">if</span>(  mxIsInf(  -(matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#04bc197503de22dd51f33c289d930d60" title="bl is a pointer to the lower bounds on the constraints">bl</a>[i]) ) ) matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#04bc197503de22dd51f33c289d930d60" title="bl is a pointer to the lower bounds on the constraints">bl</a>[ i] = -OSINFINITY;
<a name="l00086"></a>00086           }
<a name="l00087"></a>00087      }
<a name="l00088"></a>00088      <span class="comment">//</span>
<a name="l00089"></a>00089      <span class="comment">//</span>
<a name="l00090"></a>00090      <span class="keywordflow">if</span>(  !mxIsEmpty( prhs[ 4]) ){
<a name="l00091"></a>00091           <span class="keywordflow">if</span> (mxGetN(prhs[4]) != matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#fe790121e25d4e2e3d25ca2f2a5e0bb7" title="numCon is the number of constraints in the problem">numCon</a> ){
<a name="l00092"></a>00092                mexErrMsgTxt(<span class="stringliteral">" Vector BU size must equal the number of rows\n"</span>);
<a name="l00093"></a>00093           }
<a name="l00094"></a>00094           matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#7d3fd42c2c214b89fee4b262b34e420f" title="bu is a pointer to the upper bounds on the constraints">bu</a> =  mxGetPr( prhs[ 4]);
<a name="l00095"></a>00095           <span class="comment">// convert Matlab infinity to OS infinity</span>
<a name="l00096"></a>00096           <span class="keywordflow">for</span>(i = 0;  i &lt; matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#fe790121e25d4e2e3d25ca2f2a5e0bb7" title="numCon is the number of constraints in the problem">numCon</a>;  i++){
<a name="l00097"></a>00097                <span class="keywordflow">if</span>(  mxIsInf( matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#7d3fd42c2c214b89fee4b262b34e420f" title="bu is a pointer to the upper bounds on the constraints">bu</a>[i]) ) matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#7d3fd42c2c214b89fee4b262b34e420f" title="bu is a pointer to the upper bounds on the constraints">bu</a>[ i] = OSINFINITY;
<a name="l00098"></a>00098           }
<a name="l00099"></a>00099      }
<a name="l00100"></a>00100      <span class="comment">//</span>
<a name="l00101"></a>00101      <span class="comment">//</span>
<a name="l00102"></a>00102      <span class="keywordflow">if</span> (mxGetN(prhs[5]) != matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#e67ede641207a71642fb0c18d455c71b" title="numVar is the number of variables in the problem">numVar</a> ){
<a name="l00103"></a>00103           mexErrMsgTxt(<span class="stringliteral">" Vector OBJ size must equal the number of variables\n"</span>);
<a name="l00104"></a>00104      }
<a name="l00105"></a>00105      matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#1e5cced5aecb4cbb69b3ae65fdd8da4d" title="obj is a pointer to the objective function coefficients">obj</a> =  mxGetPr( prhs[ 5]);
<a name="l00106"></a>00106      <span class="comment">//</span>
<a name="l00107"></a>00107      <span class="comment">//</span>
<a name="l00108"></a>00108      <span class="keywordflow">if</span>(  !mxIsEmpty( prhs[ 6]) ){
<a name="l00109"></a>00109           <span class="keywordflow">if</span> (mxGetN(prhs[6]) != matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#e67ede641207a71642fb0c18d455c71b" title="numVar is the number of variables in the problem">numVar</a> ){
<a name="l00110"></a>00110                mexErrMsgTxt(<span class="stringliteral">" Vector VL size must equal the number of variables\n"</span>);
<a name="l00111"></a>00111           }
<a name="l00112"></a>00112           matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#7a1edf584fb8be0cbbea6479da92dbf9" title="vl is a pointer to the lower bounds on the varialbes">vl</a> =  mxGetPr( prhs[ 6]);
<a name="l00113"></a>00113           <span class="comment">// convert Matlab -infinity to OS -infinity</span>
<a name="l00114"></a>00114           <span class="keywordflow">for</span>(i = 0;  i &lt; matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#e67ede641207a71642fb0c18d455c71b" title="numVar is the number of variables in the problem">numVar</a>;  i++){
<a name="l00115"></a>00115                <span class="keywordflow">if</span>(  mxIsInf(  -(matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#7a1edf584fb8be0cbbea6479da92dbf9" title="vl is a pointer to the lower bounds on the varialbes">vl</a>[i]) ) ) matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#7a1edf584fb8be0cbbea6479da92dbf9" title="vl is a pointer to the lower bounds on the varialbes">vl</a>[ i] = -OSINFINITY;
<a name="l00116"></a>00116           }
<a name="l00117"></a>00117      }
<a name="l00118"></a>00118      <span class="comment">//</span>
<a name="l00119"></a>00119      <span class="comment">//</span>
<a name="l00120"></a>00120      <span class="keywordflow">if</span>(  !mxIsEmpty( prhs[ 7]) ){
<a name="l00121"></a>00121           <span class="keywordflow">if</span> (mxGetN(prhs[7]) != matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#e67ede641207a71642fb0c18d455c71b" title="numVar is the number of variables in the problem">numVar</a> ){
<a name="l00122"></a>00122                mexErrMsgTxt(<span class="stringliteral">" Vector VU size must equal the number of variables\n"</span>);
<a name="l00123"></a>00123           }
<a name="l00124"></a>00124           matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#c66a0c5153c664148c3297ec51b146b1" title="vu is a pointer to the upper bounds on the variables">vu</a> =  mxGetPr( prhs[ 7]);
<a name="l00125"></a>00125           <span class="comment">// convert Matlab infinity to OS infinity</span>
<a name="l00126"></a>00126           <span class="keywordflow">for</span>(i = 0;  i &lt; matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#e67ede641207a71642fb0c18d455c71b" title="numVar is the number of variables in the problem">numVar</a>;  i++){
<a name="l00127"></a>00127                <span class="keywordflow">if</span>(  mxIsInf( matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#c66a0c5153c664148c3297ec51b146b1" title="vu is a pointer to the upper bounds on the variables">vu</a>[i]) ) matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#c66a0c5153c664148c3297ec51b146b1" title="vu is a pointer to the upper bounds on the variables">vu</a>[ i] = OSINFINITY;
<a name="l00128"></a>00128           }
<a name="l00129"></a>00129      }
<a name="l00130"></a>00130      <span class="comment">//</span>
<a name="l00131"></a>00131      <span class="comment">//</span>
<a name="l00132"></a>00132      <span class="keywordflow">if</span> ( (mxGetScalar( prhs[ 8]) != 0) &amp;&amp; (mxGetScalar( prhs[ 8]) != 1)){
<a name="l00133"></a>00133           mexErrMsgTxt(<span class="stringliteral">" The objective type must be either 1 (max) or 0 (min)\n"</span>);
<a name="l00134"></a>00134      }
<a name="l00135"></a>00135      mxGetScalar( prhs[ 8]) &gt; 0 ?  matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#d104f16188bc77bd22d580855a29eed3" title="objType indicates whether or not we have a max (1) or a min (0)">objType</a> = 1 : matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#d104f16188bc77bd22d580855a29eed3" title="objType indicates whether or not we have a max (1) or a min (0)">objType</a> = 0; 
<a name="l00136"></a>00136      <span class="comment">//printf("Objective Function Type = %d\n", matlabModel-&gt;objType);</span>
<a name="l00137"></a>00137      <span class="comment">//</span>
<a name="l00138"></a>00138      <span class="comment">// get the variable types, this is character data</span>
<a name="l00139"></a>00139      <span class="keywordflow">if</span>(!mxIsChar( prhs[ 9])){
<a name="l00140"></a>00140           mexErrMsgTxt(<span class="stringliteral">" Vector VarType  must be a character array\n"</span>);
<a name="l00141"></a>00141      }
<a name="l00142"></a>00142      <span class="keywordflow">if</span> (mxGetN(prhs[ 9]) != matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#e67ede641207a71642fb0c18d455c71b" title="numVar is the number of variables in the problem">numVar</a> ){
<a name="l00143"></a>00143           mexErrMsgTxt(<span class="stringliteral">" Vector VarType size must equal the number of variables\n"</span>);
<a name="l00144"></a>00144      }
<a name="l00145"></a>00145      buf = mxArrayToString( prhs[ 9]);
<a name="l00146"></a>00146      matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#78a63f2f14e1ec1f1b6e360476d37f81" title="varType is a pointer to the variable type eg C, B, I">varType</a> = buf;
<a name="l00147"></a>00147      
<a name="l00148"></a>00148      <span class="comment">//</span>
<a name="l00149"></a>00149      <span class="comment">// get the quadratic terms</span>
<a name="l00150"></a>00150      
<a name="l00151"></a>00151      <span class="keywordtype">int</span> j;
<a name="l00152"></a>00152      <span class="keywordtype">int</span> k = 0;
<a name="l00153"></a>00153      <span class="keywordflow">if</span>(  !mxIsEmpty( prhs[ 10]) ){
<a name="l00154"></a>00154           <span class="keywordflow">if</span>( mxGetM( prhs[ 10])  != 4) mexErrMsgTxt(<span class="stringliteral">" Vector Q Must have 4 rows\n"</span>);
<a name="l00155"></a>00155           <span class="keywordtype">int</span> numQTerms = mxGetN( prhs[ 10]);
<a name="l00156"></a>00156           <span class="comment">//printf("NUMBER OF Q TERMS =  %d \n", numQTerms);</span>
<a name="l00157"></a>00157           matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#306f16522e609bd84df0e546af2ce848" title="numQTerms is the number of quadratic terms">numQTerms</a> = numQTerms;
<a name="l00158"></a>00158           matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#a8989e9fa21a97944232dc7b50bd7a7c" title="qRows is a pointer to the row index of each quadratic term">qRows</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[ numQTerms];
<a name="l00159"></a>00159           matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#c274b39f557cf7e2c006431fa5e7f5d1" title="qIndex1 is a pointer to the index of the first variable in each of the quadratic...">qIndex1</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[ numQTerms];
<a name="l00160"></a>00160           matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#ad63e3b09672c61156599c7081217712" title="qIndex2 is a pointer to the index of the second variable in each of the quadratic...">qIndex2</a> = <span class="keyword">new</span> <span class="keywordtype">int</span>[ numQTerms];
<a name="l00161"></a>00161           matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#007650d5e35647db251526d9e62dcfd6" title="qVal is a pointer to the coefficient value of each of the quadratic terms.">qVal</a> = <span class="keyword">new</span> <span class="keywordtype">double</span>[ numQTerms];
<a name="l00162"></a>00162           pr= mxGetPr( prhs[ 10]);
<a name="l00163"></a>00163           <span class="keywordflow">for</span>(i = 0; i &lt; numQTerms; i++){
<a name="l00164"></a>00164                <span class="keywordflow">for</span>(j = 0; j &lt;= 3; j++){
<a name="l00165"></a>00165                     <span class="comment">//printf(" Q COMP = %f\n", pr[ k]) ;</span>
<a name="l00166"></a>00166                     <span class="keywordflow">switch</span>( j){
<a name="l00167"></a>00167                          <span class="keywordflow">case</span> 0:
<a name="l00168"></a>00168                               matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#a8989e9fa21a97944232dc7b50bd7a7c" title="qRows is a pointer to the row index of each quadratic term">qRows</a>[ i] = (int) pr[ k];
<a name="l00169"></a>00169                               <span class="keywordflow">break</span>;
<a name="l00170"></a>00170                          <span class="keywordflow">case</span> 1:
<a name="l00171"></a>00171                               matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#c274b39f557cf7e2c006431fa5e7f5d1" title="qIndex1 is a pointer to the index of the first variable in each of the quadratic...">qIndex1</a>[ i] = (int) pr[ k];
<a name="l00172"></a>00172                               <span class="keywordflow">break</span>;
<a name="l00173"></a>00173                          <span class="keywordflow">case</span> 2:
<a name="l00174"></a>00174                               matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#ad63e3b09672c61156599c7081217712" title="qIndex2 is a pointer to the index of the second variable in each of the quadratic...">qIndex2</a>[ i] = (int) pr[ k];
<a name="l00175"></a>00175                               <span class="keywordflow">break</span>;
<a name="l00176"></a>00176                          <span class="keywordflow">case</span> 3:
<a name="l00177"></a>00177                               matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#007650d5e35647db251526d9e62dcfd6" title="qVal is a pointer to the coefficient value of each of the quadratic terms.">qVal</a>[ i] =  pr[ k];
<a name="l00178"></a>00178                               <span class="keywordflow">break</span>;
<a name="l00179"></a>00179                     }
<a name="l00180"></a>00180                     k++;
<a name="l00181"></a>00181                }
<a name="l00182"></a>00182           }
<a name="l00183"></a>00183      }
<a name="l00184"></a>00184      <span class="keywordflow">if</span>(  !mxIsEmpty( prhs[ 11]) ){
<a name="l00185"></a>00185            matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#0064ba2f2801722be787922d6f48104d" title="instanceName is the name of the problem instance">instanceName</a> = mxArrayToString( prhs[ 11]);
<a name="l00186"></a>00186      }
<a name="l00187"></a>00187      <span class="comment">//</span>
<a name="l00188"></a>00188      buf = mxArrayToString( prhs[ 12]);
<a name="l00189"></a>00189      <span class="keyword">const</span> <span class="keywordtype">char</span> *password = <span class="stringliteral">"chicagoesmuyFRIO"</span>;
<a name="l00190"></a>00190      <span class="keywordflow">if</span>( strcmp(buf,  password) != 0) mexErrMsgTxt(<span class="stringliteral">" Incorrect Password\n"</span>);
<a name="l00191"></a>00191      <span class="comment">//</span>
<a name="l00192"></a>00192      <span class="comment">// get the name of the solver</span>
<a name="l00193"></a>00193       matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#88def0e1296484cb755e39ab4222f2f5" title="sSolverName is the name of the solver">sSolverName</a> = mxArrayToString( prhs[ 13]);    
<a name="l00194"></a>00194       printf(<span class="stringliteral">"WE ARE USING SOLVER %s\n"</span>, &amp;matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#88def0e1296484cb755e39ab4222f2f5" title="sSolverName is the name of the solver">sSolverName</a>[0]);
<a name="l00195"></a>00195      <span class="comment">//</span>
<a name="l00196"></a>00196      <span class="comment">// get the name of the solver service</span>
<a name="l00197"></a>00197       matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#637b2eff77891e73714e61537134b7ef" title="is the address of the solver service">sAgentAddress</a> = mxArrayToString( prhs[ 14]);    
<a name="l00198"></a>00198       printf(<span class="stringliteral">"WE ARE USING AGENT %s\n"</span>, &amp;matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#637b2eff77891e73714e61537134b7ef" title="is the address of the solver service">sAgentAddress</a>[0]);
<a name="l00199"></a>00199      <span class="comment">//</span>
<a name="l00200"></a>00200      <span class="comment">// create the OSInstance</span>
<a name="l00201"></a>00201      mexPrintf(<span class="stringliteral">"CREATE THE INSTANCE \n"</span>);
<a name="l00202"></a>00202      matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#86f1cb2fbc08abb0e45fb1badef52243" title="Create an OSInstance.">createOSInstance</a>();
<a name="l00203"></a>00203      mexPrintf(<span class="stringliteral">"CALL THE REMOTE SERVER \n"</span>);
<a name="l00204"></a>00204      sTest = matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#eee21d72c1fe98926b0301022158df26" title="Solve the problem instance.">solve</a>();
<a name="l00205"></a>00205      std::string osil = matlabModel-&gt;<a class="code" href="class_o_s_matlab.html#8b6067a001401945d274656eaf151e66" title="is the osil instance that gets created from the MATLAB data structures">osil</a>;
<a name="l00206"></a>00206      <span class="keywordtype">char</span> *ch = &amp;osil[0];
<a name="l00207"></a>00207      printf(<span class="stringliteral">"HERE IS THE INSTANCE %s\n"</span>, ch);
<a name="l00208"></a>00208      mexPrintf(<span class="stringliteral">"DONE WITH THE REMOTE CALL \n"</span>);
<a name="l00209"></a>00209      mexPrintf(<span class="stringliteral">"HERE IS THE SOLUTION \n"</span>);
<a name="l00210"></a>00210      mexPrintf(&amp;sTest[0] );
<a name="l00211"></a>00211     <span class="comment">//char *str[100];</span>
<a name="l00212"></a>00212      <span class="comment">//plhs[0]= mxCreateCharMatrixFromStrings(  1,    (const char **)str); </span>
<a name="l00213"></a>00213      <span class="comment">//plhs = 'DOES THIS WORK';</span>
<a name="l00214"></a>00214      <span class="comment">// garbage collection</span>
<a name="l00215"></a>00215       <span class="keywordtype">char</span> *str[ 1];
<a name="l00216"></a>00216       <span class="comment">//str[ 0] = mxArrayToString( prhs[ 9]);</span>
<a name="l00217"></a>00217       str[ 0] = &amp;sTest[0] ;
<a name="l00218"></a>00218       plhs[0]= mxCreateCharMatrixFromStrings( 1, (<span class="keyword">const</span> <span class="keywordtype">char</span> **)str); 
<a name="l00219"></a>00219      <span class="keyword">delete</span> matlabModel;
<a name="l00220"></a>00220      <span class="keywordflow">return</span>;
<a name="l00221"></a>00221 }
<a name="l00222"></a><a class="code" href="_o_s_matlab_solver_8cpp.html#fad77cd2cb47708eaaec3329c5192e2f">00222</a> <a class="code" href="class_sparse_matrix.html" title="a sparse matrix data structure">SparseMatrix</a>* <a class="code" href="_o_s_matlab_solver_8cpp.html#fad77cd2cb47708eaaec3329c5192e2f">getConstraintMatrix</a>( <span class="keyword">const</span> mxArray *prhs){
<a name="l00223"></a>00223      <a class="code" href="class_sparse_matrix.html" title="a sparse matrix data structure">SparseMatrix</a> *sparseMat = NULL;
<a name="l00224"></a>00224      sparseMat = <span class="keyword">new</span> <a class="code" href="class_sparse_matrix.html" title="a sparse matrix data structure">SparseMatrix</a>();
<a name="l00225"></a>00225     <span class="comment">/* Declare variable */</span>
<a name="l00226"></a>00226      mxArray *plhs;
<a name="l00227"></a>00227      <span class="comment">//mwSize m,n;</span>
<a name="l00228"></a>00228      <span class="comment">// mwSize nzmax;</span>
<a name="l00229"></a>00229      <span class="comment">//mwIndex *irs, *jcs, j, k;</span>
<a name="l00230"></a>00230      <span class="keywordtype">int</span> m,n;
<a name="l00231"></a>00231      <span class="keywordtype">int</span> nzmax;
<a name="l00232"></a>00232      <span class="keywordtype">int</span> *irs, *jcs, j, k;
<a name="l00233"></a>00233      <span class="keywordtype">int</span>  cmplx;
<a name="l00234"></a>00234      <span class="keywordtype">double</span> *pr, *pi, *si, *sr;
<a name="l00235"></a>00235     <span class="comment">/* Get the size and pointers to input data */</span>
<a name="l00236"></a>00236      m  = mxGetM( prhs);
<a name="l00237"></a>00237      n  = mxGetN( prhs);
<a name="l00238"></a>00238      pr = mxGetPr( prhs);
<a name="l00239"></a>00239      pi = mxGetPi( prhs);
<a name="l00240"></a>00240      cmplx = (pi==NULL ? 0 : 1);
<a name="l00241"></a>00241      nzmax = n*m;
<a name="l00242"></a>00242      plhs = mxCreateSparse(m, n, nzmax, (mxComplexity)cmplx);
<a name="l00243"></a>00243      sr  = mxGetPr( plhs);
<a name="l00244"></a>00244      si  = mxGetPi( plhs);
<a name="l00245"></a>00245      irs = mxGetIr( plhs);
<a name="l00246"></a>00246      jcs = mxGetJc( plhs);
<a name="l00247"></a>00247     <span class="comment">/* Copy nonzeros */</span>
<a name="l00248"></a>00248      k = 0;
<a name="l00249"></a>00249      <span class="keywordflow">for</span> (j=0; (j&lt;n); j++) {
<a name="l00250"></a>00250           <span class="keywordtype">int</span> i;
<a name="l00251"></a>00251           jcs[j] = k;
<a name="l00252"></a>00252           <span class="keywordflow">for</span> (i=0; (i&lt;m ); i++) {
<a name="l00253"></a>00253                <span class="keywordflow">if</span> (<a class="code" href="_o_s_matlab_solver_8cpp.html#c3792b5c39559a3c77903f7b996f5a3f">IsNonZero</a>(pr[i]) || (cmplx &amp;&amp; <a class="code" href="_o_s_matlab_solver_8cpp.html#c3792b5c39559a3c77903f7b996f5a3f">IsNonZero</a>(pi[i]))) {
<a name="l00254"></a>00254                     sr[k] = pr[i];
<a name="l00255"></a>00255                     <span class="keywordflow">if</span> (cmplx){
<a name="l00256"></a>00256                          si[k]=pi[i];
<a name="l00257"></a>00257                     }
<a name="l00258"></a>00258                     irs[k] = i;
<a name="l00259"></a>00259                     k++;
<a name="l00260"></a>00260                }
<a name="l00261"></a>00261           }
<a name="l00262"></a>00262           pr += m;
<a name="l00263"></a>00263           pi += m;
<a name="l00264"></a>00264      }
<a name="l00265"></a>00265      jcs[ n] = k;
<a name="l00266"></a>00266      <span class="keywordtype">int</span> km;
<a name="l00267"></a>00267      <span class="keywordflow">for</span>(j = 0;  j &lt; n;  j++){
<a name="l00268"></a>00268           <span class="comment">//printf("Column start = %d\n", jcs[ j]);</span>
<a name="l00269"></a>00269           <span class="keywordflow">for</span>(km = jcs[ j]; km &lt; jcs[ j+1]; km++ ){
<a name="l00270"></a>00270                <span class="comment">// printf("row index= %d\n",  irs[ km]);</span>
<a name="l00271"></a>00271                <span class="comment">//  printf("nonzero value = %f\n",   sr[ km]);</span>
<a name="l00272"></a>00272           }
<a name="l00273"></a>00273      }
<a name="l00274"></a>00274      <span class="comment">// now fill in a sparse matrix data structure</span>
<a name="l00275"></a>00275      sparseMat-&gt;<a class="code" href="class_sparse_matrix.html#40a013e693d6061560ab2e08125739ec" title="bDeleteArrays is true if we delete the arrays in garbage collection set to true by...">bDeleteArrays</a> = <span class="keyword">false</span>;
<a name="l00276"></a>00276      sparseMat-&gt;<a class="code" href="class_sparse_matrix.html#b3aec6d580c0624b1d941407e2b790eb" title="isColumnMajor holds whether the coefMatrix (AMatrix) holding linear program data...">isColumnMajor</a> = <span class="keyword">true</span>;
<a name="l00277"></a>00277      sparseMat-&gt;<a class="code" href="class_sparse_matrix.html#d131c77e5fb53a58e76fe5e453d46d13" title="startSize is the dimension of the starts array">startSize</a> = n + 1;
<a name="l00278"></a>00278      sparseMat-&gt;<a class="code" href="class_sparse_matrix.html#34abe6faadb97fe68413ec1a50ee8375" title="valueSize is the dimension of the starts array">valueSize</a> = jcs[ n];
<a name="l00279"></a>00279      sparseMat-&gt;<a class="code" href="class_sparse_matrix.html#411fe5458337ef7b12702d3854185114" title="starts holds an integer array of start elements in coefMatrix (AMatrix), which points...">starts</a> = jcs;
<a name="l00280"></a>00280      sparseMat-&gt;<a class="code" href="class_sparse_matrix.html#1bff0b9e6baf3c1e6ef67125b43a9929" title="indexes holds an integer array of rowIdx (or colIdx) elements in coefMatrix (AMatrix)...">indexes</a> = irs;
<a name="l00281"></a>00281      sparseMat-&gt;<a class="code" href="class_sparse_matrix.html#5116e5f2dfaf8215745b682629a2c2c5" title="values holds a double array of value elements in coefMatrix (AMatrix), which contains...">values</a> = sr;
<a name="l00282"></a>00282      <span class="keywordflow">return</span> sparseMat;
<a name="l00283"></a>00283 }
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Sat Mar 29 22:38:02 2008 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
