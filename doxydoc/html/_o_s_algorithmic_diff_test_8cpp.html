<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>/Users/kmartin/Documents/files/code/cpp/OScpp/COIN-OS/OS/examples/algorithmicDiff/OSAlgorithmicDiffTest.cpp File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="classes.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>/Users/kmartin/Documents/files/code/cpp/OScpp/COIN-OS/OS/examples/algorithmicDiff/OSAlgorithmicDiffTest.cpp File Reference</h1><code>#include &lt;cstddef&gt;</code><br>
<code>#include &lt;cstdlib&gt;</code><br>
<code>#include &lt;cctype&gt;</code><br>
<code>#include &lt;cassert&gt;</code><br>
<code>#include &lt;stack&gt;</code><br>
<code>#include &lt;cppad/cppad.hpp&gt;</code><br>
<code>#include &lt;iostream&gt;</code><br>
<code>#include &quot;CoinHelperFunctions.hpp&quot;</code><br>
<code>#include &quot;<a class="el" href="_o_s_instance_8h-source.html">OSInstance.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="_o_si_l_writer_8h-source.html">OSiLWriter.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="_o_s_parameters_8h-source.html">OSParameters.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="_o_sn_l_node_8h-source.html">OSnLNode.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="_o_s_error_class_8h-source.html">OSErrorClass.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="_o_s_file_util_8h-source.html">OSFileUtil.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="_o_si_l_reader_8h-source.html">OSiLReader.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="_o_s_expression_tree_8h-source.html">OSExpressionTree.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="_o_s_data_structures_8h-source.html">OSDataStructures.h</a>&quot;</code><br>
<code>#include &lt;vector&gt;</code><br>
<code>#include &lt;map&gt;</code><br>
<code>#include &lt;string&gt;</code><br>

<p>
<a href="_o_s_algorithmic_diff_test_8cpp-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_o_s_algorithmic_diff_test_8cpp.html#e66f6b31b5ad750f1fe042a706a4e3d4">main</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_o_s_algorithmic_diff_test_8cpp.html#78a7e0664388a2a1744a4bd0806f7846">CheckFunctionValues</a> (double *conVals, double objValue, double x0, double x1, double x2, double x3, double z0, double z1, double w)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_o_s_algorithmic_diff_test_8cpp.html#cca0a2bb3b0abea361ebb4cf695704b0">CheckGradientValues</a> (<a class="el" href="class_sparse_jacobian_matrix.html">SparseJacobianMatrix</a> *sparseJac, double *objGrad, double x0, double x1, double x2, double x3, double y0, double y1, double w)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="_o_s_algorithmic_diff_test_8cpp.html#854ebd4863364ac35ff9b0006b92fdff">CheckHessianUpper</a> (<a class="el" href="class_sparse_hessian_matrix.html">SparseHessianMatrix</a> *sparseHessian, double x0, double x1, double x2, double x3, double z0, double z1, double w)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="e66f6b31b5ad750f1fe042a706a4e3d4"></a><!-- doxytag: member="OSAlgorithmicDiffTest.cpp::main" ref="e66f6b31b5ad750f1fe042a706a4e3d4" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>
create function with domain the variables and range objective function plus constraint values IMPORTANT: the forwardAD and reverseAD calls ONLY apply to the nonlinear part of the problem. The 9*x1 term in the objective is not part of the AD calculation nor are any terms in &lt;linearConstraintCoefficients&gt; that DO NOT appear in any nl nodes, for example the 7*x2 term in constraint with index 1. Note also, that there are only three variables that appear in nl nodes, x2 does not<p>
get an index map of the nonlinear variables and see which variable are in &lt;nonlinearExpressions&gt; element<p>
iterate through and get an index of all variables that are in &lt;nonlinearExpressions&gt; element<p>
Now start to calculate function values and derivatives there are three nonlinear variables and we put their values into the vector x0<p>
now use forward to get the mixed second partials with respect to variable x0 and x3 of every function in the range space<p>
Since we want the mixed partials of x0 and x3 we take the sum of the appropriate unit vectors and do a forward order 1 again<p>
function values cannot be calculated with the reverse sweep, in order to do a reverse sweep, a forward sweep with at least p = 0 must be complete<p>
in the example below we get the third row of the Jacobian using a reverse sweep.<p>
for everything below to work out we must go back and do a forward sweep with respect to third unit vector, i.e. we do a forwardAD(1, e^{3})<p>
reverseAD(2, vlambda) will produce a vector of size 2*n, the terms 0, 2, 4, 2*n - 2 will be the first partials of the Lagrangian formed using vlambda the terms 1, 3, ..., 2*n - 1 will be column (row) row i of the Hessian of Lagrangian assuming we did a forwardAD(1, e^{i}) where e^{i} is the i'th unit vector<p>
get the third row (column) of the Lagrangian of the Hessian matrix, it the third row because we did a forwardAD(1, e^{3})<p>
most solver APIs work with pointers and not vectors so the OS API works with pointer here the values of the primal and Lagrange multipliers that we use<p>
first we show different calls to get constraint and objective function values, many of this function calls are overloaded, for example, to evaluate all of the constraints at the current value of x use<p>
calculateAllConstraintFunctionValues(double* x, double *objLambda, double *conLambda, bool new_x, int highestOrder)<p>
if you want the functions values calculated using the algorithmic differentiation package. This may be desirable if you are also going to calculate derivatives at the same time. However, use<p>
calculateAllConstraintFunctionValues(double* x, bool new_x)<p>
if you are going to do a lot of function evaluations without derivative calculations, this way you do not need to use operator overloading<p>
Similar remarks apply to the objective functions<p>
if you want to get a function value by index here that signature<p>
double calculateFunctionValue(int idx, double* x, bool new_x);<p>
for example, use calculateFunctionValue(-1, x, true) to get the first objective function value<p>
Most solvers that provide call backs want sparsity pattern. Jacobian and Hessain sparsity patters are provided by the <a class="el" href="class_o_s_instance.html" title="The in-memory representation of an OSiL instance..">OSInstance</a> API<p>
Most solvers that provide call backs want Jacobian calculation. <a class="el" href="class_constraint.html" title="The in-memory representation of the &lt;con&gt; element.">Constraint</a> Jacobians and objective function gradients are provided <a class="el" href="class_o_s_instance.html" title="The in-memory representation of an OSiL instance..">OSInstance</a> API the basic signature for these functions is<p>
calculateAllConstraintFunctionGradients(double* x, double *objLambda, double *conLambda, bool new_x, int highestOrder)<p>
If we have already calculated function values using the AD routine, then highestOrder = 0, if we calculated function values using the OS expression tree then highestOrder = -1. Then if new_x = false and highestOrder = 0 and we make a gradient calcuation, then forwardAD(0, x) WILL NOT be called and there is a savings<p>
Some solvers that provide call backs want the Hessian of the Lagrangian function. This is provided by the <a class="el" href="class_o_s_instance.html" title="The in-memory representation of an OSiL instance..">OSInstance</a> API<p>
Since we have already made the gradient calcualations we set new_x = false.<p>
If the solver knows that at an iteration all of the derivative information is required then calculating the function values, Jacobian, and Hessian at the same time is the most efficient thing to do. This is by setting highestOrder = 2. Regardless of whether the call is to calculate function values for object or constraint, Jacobians, or even Hessian, setting highestOrder = 2 results in all derivative being calculated<p>
If we just wanted objective function values we could have used<p>
osinstance-&gt;calculateAllObjectiveFunctionValues( x, w, z, true, 0)<p>
--OR --<p>
calculateAllObjectiveFunctionValues(double* x, bool new_x)<p>
however since we make a call with highestOrder = 2 all derivatives are calculated and no other calls are necessary<p>
Since we called calculateAllObjectiveFunctionValues() with highestOrder = 2 the first derivative information is available<p>
we can also calculate the Hessian of any row or objective function the function signature is <a class="el" href="class_sparse_hessian_matrix.html" title="The in-memory representation of a SparseHessianMatrix..">SparseHessianMatrix</a> *calculateHessian( double* x, int idx, bool new_x); Below we get the Hessian for row 1 , Note we set new_x to true since the Lagrange multipliers changed 
<p>Definition at line <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html#l00103">103</a> of file <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html">OSAlgorithmicDiffTest.cpp</a>.</p>

<p>References <a class="el" href="_o_s_instance_8h-source.html#l02240">OSInstance::bUseExpTreeForFunEval</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l02201">OSInstance::calculateAllConstraintFunctionGradients()</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l02138">OSInstance::calculateAllConstraintFunctionValues()</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l02170">OSInstance::calculateAllObjectiveFunctionValues()</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l02078">OSInstance::calculateFunctionValue()</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l02321">OSInstance::calculateHessian()</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l02306">OSInstance::calculateLagrangianHessian()</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l02281">OSInstance::calculateObjectiveFunctionGradient()</a>, <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html#l00734">CheckFunctionValues()</a>, <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html#l00757">CheckGradientValues()</a>, <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html#l00792">CheckHessianUpper()</a>, <a class="el" href="_o_s_data_structures_8h-source.html#l00196">SparseJacobianMatrix::conVals</a>, <a class="el" href="_o_s_error_class_8h-source.html#l00042">ErrorClass::errormsg</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l02873">OSInstance::forwardAD()</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l02691">OSInstance::getAllNonlinearVariablesIndexMap()</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l00996">OSInstance::getConstraintNumber()</a>, <a class="el" href="_o_s_file_util_8cpp-source.html#l00031">FileUtil::getFileAsString()</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l01942">OSInstance::getJacobianSparsityPattern()</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l02728">OSInstance::getLagrangianHessianSparsityPattern()</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l00883">OSInstance::getObjectiveNumber()</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l00783">OSInstance::getVariableNumber()</a>, <a class="el" href="_o_s_data_structures_8h-source.html#l00266">SparseHessianMatrix::hessColIdx</a>, <a class="el" href="_o_s_data_structures_8h-source.html#l00256">SparseHessianMatrix::hessDimension</a>, <a class="el" href="_o_s_data_structures_8h-source.html#l00261">SparseHessianMatrix::hessRowIdx</a>, <a class="el" href="_o_s_data_structures_8h-source.html#l00271">SparseHessianMatrix::hessValues</a>, <a class="el" href="_o_s_data_structures_8h-source.html#l00201">SparseJacobianMatrix::indexes</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l03224">OSInstance::initForAlgDiff()</a>, <a class="el" href="_o_s_parameters_8h-source.html#l00089">OS_NEAR_EQUAL</a>, <a class="el" href="_o_s_parseosil_8tab_8cpp-source.html#l01794">osinstance</a>, <a class="el" href="_o_si_l_reader_8cpp-source.html#l00045">OSiLReader::readOSiL()</a>, <a class="el" href="_o_s_instance_8cpp-source.html#l02893">OSInstance::reverseAD()</a>, <a class="el" href="_o_s_data_structures_8h-source.html#l00190">SparseJacobianMatrix::starts</a>, <a class="el" href="_o_s_data_structures_8h-source.html#l00179">SparseJacobianMatrix::startSize</a>, and <a class="el" href="_o_s_data_structures_8h-source.html#l00206">SparseJacobianMatrix::values</a>.</p>

</div>
</div><p>
<a class="anchor" name="78a7e0664388a2a1744a4bd0806f7846"></a><!-- doxytag: member="OSAlgorithmicDiffTest.cpp::CheckFunctionValues" ref="78a7e0664388a2a1744a4bd0806f7846" args="(double *conVals, double objValue, double x0, double x1, double x2, double x3, double z0, double z1, double w)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CheckFunctionValues           </td>
          <td>(</td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>conVals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>objValue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>z0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>z1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>w</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html#l00734">734</a> of file <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html">OSAlgorithmicDiffTest.cpp</a>.</p>

<p>References <a class="el" href="_o_s_parameters_8h-source.html#l00089">OS_NEAR_EQUAL</a>.</p>

<p>Referenced by <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html#l00103">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="cca0a2bb3b0abea361ebb4cf695704b0"></a><!-- doxytag: member="OSAlgorithmicDiffTest.cpp::CheckGradientValues" ref="cca0a2bb3b0abea361ebb4cf695704b0" args="(SparseJacobianMatrix *sparseJac, double *objGrad, double x0, double x1, double x2, double x3, double y0, double y1, double w)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CheckGradientValues           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_sparse_jacobian_matrix.html">SparseJacobianMatrix</a> *&nbsp;</td>
          <td class="paramname"> <em>sparseJac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&nbsp;</td>
          <td class="paramname"> <em>objGrad</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>y0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>y1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>w</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html#l00757">757</a> of file <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html">OSAlgorithmicDiffTest.cpp</a>.</p>

<p>References <a class="el" href="_o_s_parameters_8h-source.html#l00089">OS_NEAR_EQUAL</a>, and <a class="el" href="_o_s_data_structures_8h-source.html#l00206">SparseJacobianMatrix::values</a>.</p>

<p>Referenced by <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html#l00103">main()</a>.</p>

</div>
</div><p>
<a class="anchor" name="854ebd4863364ac35ff9b0006b92fdff"></a><!-- doxytag: member="OSAlgorithmicDiffTest.cpp::CheckHessianUpper" ref="854ebd4863364ac35ff9b0006b92fdff" args="(SparseHessianMatrix *sparseHessian, double x0, double x1, double x2, double x3, double z0, double z1, double w)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CheckHessianUpper           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="class_sparse_hessian_matrix.html">SparseHessianMatrix</a> *&nbsp;</td>
          <td class="paramname"> <em>sparseHessian</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>x3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>z0</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>z1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&nbsp;</td>
          <td class="paramname"> <em>w</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Definition at line <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html#l00792">792</a> of file <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html">OSAlgorithmicDiffTest.cpp</a>.</p>

<p>References <a class="el" href="_o_s_data_structures_8h-source.html#l00271">SparseHessianMatrix::hessValues</a>.</p>

<p>Referenced by <a class="el" href="_o_s_algorithmic_diff_test_8cpp-source.html#l00103">main()</a>.</p>

</div>
</div><p>
<hr size="1"><address style="text-align: right;"><small>Generated on Sat Mar 29 22:38:03 2008 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
